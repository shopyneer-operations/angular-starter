<div class="container mx-auto p-5" dir="rtl">
  <!-- Header -->
  <div class="flex flex-row justify-between">
    <h1 class="font-bold text-2xl m-8">عربة التسوق</h1>
    <div class="flex flex-col justify-center items-center">
      <button
        class="bg-[#EF3D6F] text-white font-medium text-sm px-8 py-3 rounded-lg shadow-md transition-transform transform hover:scale-105"
        (click)="navigateToProducts()"
      >
        اكتشف كل المنتجات
        <i class="fas fa-arrow-left ml-2"></i>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex justify-center items-center h-64">
    <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-[#EF3D6F]"></div>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="text-center text-red-500 p-4">
    {{ error }}
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && !error" class="flex flex-col md:flex-row gap-6">
    <!-- Left Section: Cart Products -->
    <div class="flex-1 flex flex-col gap-6">
      <!-- Empty Cart State -->
      <div *ngIf="cartItems.length === 0" class="text-center text-gray-600 p-4">
        عربة التسوق فارغة. أضف بعض المنتجات!
      </div>

      <!-- Cart Items -->
      <div *ngFor="let item of cartItems; let i = index; trackBy: trackByItemId"
           class="bg-gray-100 rounded-lg p-6 shadow-lg flex flex-col md:flex-row justify-between gap-6">
        <!-- Left Section (Price) -->
        <div class="flex flex-col items-start md:w-1/4">
          <span class="text-[#EF3D6F] text-2xl font-bold">{{ item.unit_price || 0 }} جنيه</span>
          <span class="text-gray-500 text-sm flex items-center gap-1">
            <img src="assets/images/car-cart.png" alt="Fast Shipping" class="w-8 h-8 inline" />
            الشحن محلي
          </span>
        </div>
        <!-- Middle Section (Product Details + Buttons) -->
        <div class="flex flex-col md:w-2/4" dir="rtl">
          <h3 class="text-lg font-bold text-[#000000] mb-2">{{ item.product_title || 'غير متوفر' }}</h3>
          <div class="flex items-center gap-1 mb-2">
            <div class="text-[#FFCA2D] flex">
              <i class="fas fa-star" *ngFor="let star of [1, 2, 3, 4]"></i>
              <i class="fas fa-star text-[#E1E1E1]"></i>
            </div>
            <span class="text-sm text-[#E1E1E1]">(100)</span>
          </div>
          <p class="text-lg text-[#000000] font-bold mb-4">
            اطلب خلال <span class="text-[#471221]">10 ساعات و 50 دقيقة</span> واحصل على
            <img src="assets/images/car-cart.png" alt="Fast Shipping" class="w-8 h-8 inline" />
            الشحن محلي.
          </p>
          <h1 class="mb-4 font-bold"> المقاس: {{ item.variant_title || 'غير متوفر' }}</h1>
          <h1 class="mb-4 font-bold"> الماركة: {{ item.product?.brand?.title || 'شيجلام' }}</h1>
          <div class="flex items-center gap-4 flex-wrap">
            <div class="flex items-center gap-2 bg-[#FDEBF0]">
              <button class="px-3 py-2 text-[#EF3D6F] rounded-lg" (click)="decreaseQuantity(i)" aria-label="تقليل الكمية">-</button>
              <span class="text-[#000000] font-semibold">{{ item.quantity }}</span>
              <button class="px-3 py-2 text-[#EF3D6F] rounded-lg" (click)="increaseQuantity(i)" aria-label="زيادة الكمية">+</button>
            </div>
            <button class="p-3 bg-[#FDEBF0] text-[#EF3D6F]" aria-label="إضافة إلى قائمة الأمنيات">
              <i class="fas fa-heart"></i>
            </button>
            <button class="px-4 py-2 text-[#000000] bg-[#FFFFFF]" (click)="removeItem(i)">
              حذف من العربة <i class="fas fa-trash-alt"></i>
            </button>
          </div>
        </div>
        <!-- Right Section (Image) -->
        <div class="flex justify-center items-center md:w-1/4">
          <img [src]="item.thumbnail || 'assets/images/cart.png'" alt="Product Image" class="w-24 h-auto rounded" />
        </div>
      </div>
    </div>

    <!-- Right Section: Order Summary -->
    <div *ngIf="cartItems.length != 0" class="md:w-1/3 bg-white border rounded-lg shadow-md p-6" dir="rtl">
      <h2 class="text-xl font-semibold text-[#471221] mb-4">ملخص الأوردر</h2>
      <div class="flex items-center space-x-2 mb-4">
        <input
          type="text"
          placeholder="ادخل كود الخصم"
          class="w-full px-4 py-2 m-2 rounded-md text-right"
          [(ngModel)]="discountCode"
        />
        <button class="px-4 py-2 m-2 bg-[#EF3D6F] text-white font-medium rounded-md" (click)="applyDiscountCode()">
          تطبيق
        </button>
      </div>
      <div class="text-right">
        <p class="flex justify-between items-center mb-2 text-[#000000] font-bold">
          <span>المجموع الفرعي</span>
          <span>{{ subtotal | number:'1.2-2' }} جنيه</span>
        </p>
        <p class="flex justify-between items-center mb-2 text-[#000000] font-bold">
          <span>رسوم الشحن</span>
          <span>{{ shippingTotal | number:'1.2-2' }} جنيه</span>
        </p>
        <p *ngIf="discountTotal > 0" class="flex justify-between items-center mb-2 text-[#000000] font-bold">
          <span>الخصم</span>
          <span>-{{ discountTotal | number:'1.2-2' }} جنيه</span>
        </p>
        <hr class="my-4">
        <p class="flex justify-between items-center text-lg font-semibold text-red-500">
          <span class="text-[#471221]">المجموع</span>
          <span class="text-[#EF3D6F]">{{ total | number:'1.2-2' }} جنيه</span>
        </p>
      </div>
      <button routerLink="/check-out" class="w-full mt-4 py-2 bg-[#EF3D6F] text-white font-medium rounded-lg">
        إتمام الشراء
      </button>
    </div>
  </div>
</div>