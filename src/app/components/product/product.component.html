<div
  class="relative product w-64 h-96 sm:w-72 sm:h-[28rem] flex flex-col bg-white rounded-2xl shadow-md hover:shadow-xl transition-transform duration-300 transform hover:scale-105 p-4 m-2 overflow-hidden"
  dir="rtl"
>
  <!-- Favorite Icon -->
  <button
    (click)="toggleWishlist()"
    class="absolute top-3 left-3 z-10 bg-white rounded-full p-2 shadow hover:bg-gray-100 transition duration-200 focus:outline-none focus:ring-2 focus:ring-[#EF3D6F]"
    aria-label="إضافة/إزالة من قائمة الأمنيات"
    title="إضافة/إزالة من قائمة الأمنيات"
  >
    <i class="{{ isInWishlist ? 'fas fa-heart' : 'far fa-heart' }} text-lg text-[#EF3D6F] hover:text-[#D02A58]"></i>
  </button>

  <!-- Product Image -->
  <div class="relative bg-gray-100 rounded-xl p-3 overflow-hidden h-48 sm:h-56">
    <img
      [src]="product.thumbnail"
      [alt]="product.title"
      class="w-full h-full object-cover rounded-md cursor-pointer border border-gray-200 transition-transform duration-300 hover:scale-105"
      routerLink="/product-details/{{product.id}}"
      loading="lazy"
    />

    <!-- Cart Icon -->
    <button
      class="absolute bottom-2 left-2 bg-[#EF3D6F] text-white p-2 rounded-full shadow-md hover:bg-[#D02A58] transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-[#EF3D6F]"
      (click)="navigateToCart()"
      [disabled]="isAddingToCart || !product.variants?.length"
      aria-label="إضافة إلى السلة"
      title="إضافة إلى السلة"
    >
      <i class="fas fa-shopping-cart text-sm"></i>
    </button>

    <!-- Discount Badge -->
    <div
      *ngIf="discount > 0"
      class="absolute top-2 right-2 bg-[#471221] text-white text-[0.7rem] px-2 py-1 rounded-full shadow"
    >
      خصم {{ discount | number: '1.0-0' }}%
    </div>
  </div>

  <!-- Product Details -->
  <div class="flex flex-col mt-4 flex-grow">
    <h3 class="text-sm sm:text-base font-semibold text-gray-800 leading-5 line-clamp-2">
      {{ product.title }}
    </h3>

    <div class="flex items-center justify-between mt-2">
      <span
        *ngIf="discount > 0"
        class="text-gray-400 line-through text-sm"
        >{{ originalPrice }} {{ currencyCode }}</span
      >
      <span class="text-[#EF3D6F] text-right font-bold text-sm sm:text-base">
        {{ discountedPrice }} {{ currencyCode }}
      </span>
    </div>

    <!-- Sold Info -->
    <div class="flex flex-row text-xs mt-3">
      <i class="fa fa-cart-plus fa-2x text-[#4CAF50]" aria-hidden="true"></i>
      <span class="font-semibold mr-2">تم بيع +2000 مؤخرا</span>
    </div>

    <div
      class="flex flex-row bg-[#FDEBF0] rounded-full w-fit mt-2 px-3 items-center gap-1"
      dir="rtl"
    >
      <span>({{ product.ratingCount || 0 }} تقييم)</span>
      <i class="fas fa-star text-[#FFCA2D]"></i>
    </div>
  </div>
</div>